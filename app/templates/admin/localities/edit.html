{% extends "admin/base.html" %}

{% block title %}Edit Locality - Premium Real Estate Admin{% endblock %}
{% block page_title %}Edit Locality{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-enhanced.css') }}">
{% endblock %}

{% block content %}
<!-- Enhanced Page Header -->
<div class="page-header">
    <div class="container-fluid">
        <h1><i class="fas fa-edit"></i> Edit Premium Locality</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('admin.localities') }}">Localities</a></li>
                <li class="breadcrumb-item active">Edit Locality</li>
            </ol>
        </nav>
    </div>
</div>

<div class="luxury-card">
    <div class="card-header">
        <h5><i class="fas fa-map-marked-alt"></i> Locality Information</h5>
    </div>
    <div class="card-body">
        <form method="POST" id="localityForm">
            <!-- Basic Information -->
            <div class="row">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-info-circle"></i> Basic Information</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="name" class="form-label"><i class="fas fa-map-pin"></i> Locality Name *</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ locality.name }}" required placeholder="e.g., Bandra, Andheri, Whitefield">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="city_id" class="form-label"><i class="fas fa-city"></i> City *</label>
                        <select class="form-select" id="city_id" name="city_id" required>
                            <option value="">Select City</option>
                            {% for city in cities %}
                            <option value="{{ city.city_id }}" {% if city.city_id == locality.city_id %}selected{% endif %}>{{ city.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="locality_type" class="form-label"><i class="fas fa-tag"></i> Locality Type</label>
                        <select class="form-select" id="locality_type" name="locality_type">
                            <option value="">Select Type</option>
                            <option value="residential" {% if locality.locality_type == 'residential' %}selected{% endif %}>Residential</option>
                            <option value="commercial" {% if locality.locality_type == 'commercial' %}selected{% endif %}>Commercial</option>
                            <option value="industrial" {% if locality.locality_type == 'industrial' %}selected{% endif %}>Industrial</option>
                            <option value="mixed" {% if locality.locality_type == 'mixed' %}selected{% endif %}>Mixed</option>
                            <option value="suburban" {% if locality.locality_type == 'suburban' %}selected{% endif %}>Suburban</option>
                            <option value="urban" {% if locality.locality_type == 'urban' %}selected{% endif %}>Urban</option>
                            <option value="rural" {% if locality.locality_type == 'rural' %}selected{% endif %}>Rural</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Location Details -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-location-arrow"></i> Location Details</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="pincode" class="form-label"><i class="fas fa-mail-bulk"></i> Pincode</label>
                        <div class="input-with-unit">
                            <input type="text" class="form-control" id="pincode" name="pincode" value="{{ locality.pincode }}" pattern="[0-9]{6}" maxlength="6" placeholder="6-digit code">
                            <div class="input-unit">PIN</div>
                        </div>
                        <div class="form-text">Enter 6-digit postal code</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="latitude" class="form-label"><i class="fas fa-map-marker-alt"></i> Latitude</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.00000001" min="-90" max="90" class="form-control" id="latitude" name="latitude" value="{{ locality.latitude }}" placeholder="Enter latitude">
                            <div class="input-unit">°</div>
                        </div>
                        <div class="form-text">Valid range: -90° to 90°</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="longitude" class="form-label"><i class="fas fa-map-marker-alt"></i> Longitude</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.00000001" min="-180" max="180" class="form-control" id="longitude" name="longitude" value="{{ locality.longitude }}" placeholder="Enter longitude">
                            <div class="input-unit">°</div>
                        </div>
                        <div class="form-text">Valid range: -180° to 180°</div>
                    </div>
                </div>
            </div>
            
            <!-- Infrastructure & Connectivity -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-road"></i> Infrastructure & Connectivity</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="distance_from_airport" class="form-label"><i class="fas fa-plane"></i> Distance from Airport</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.1" class="form-control" id="distance_from_airport" name="distance_from_airport" value="{{ locality.distance_from_airport if locality.distance_from_airport else '' }}" min="0" placeholder="Enter distance">
                            <div class="input-unit">km</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="distance_from_railway" class="form-label"><i class="fas fa-train"></i> Distance from Railway</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.1" class="form-control" id="distance_from_railway" name="distance_from_railway" value="{{ locality.distance_from_railway if locality.distance_from_railway else '' }}" min="0" placeholder="Enter distance">
                            <div class="input-unit">km</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="distance_from_metro" class="form-label"><i class="fas fa-subway"></i> Distance from Metro</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.1" class="form-control" id="distance_from_metro" name="distance_from_metro" value="{{ locality.distance_from_metro if locality.distance_from_metro else '' }}" min="0" placeholder="Enter distance">
                            <div class="input-unit">km</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="distance_from_highway" class="form-label"><i class="fas fa-road"></i> Distance from Highway</label>
                        <div class="input-with-unit">
                            <input type="number" step="0.1" class="form-control" id="distance_from_highway" name="distance_from_highway" value="{{ locality.distance_from_highway if locality.distance_from_highway else '' }}" min="0" placeholder="Enter distance">
                            <div class="input-unit">km</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Market Information -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-chart-line"></i> Market Information</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="avg_price_per_sqft" class="form-label"><i class="fas fa-rupee-sign"></i> Average Price per Sq Ft</label>
                        <div class="input-with-unit">
                            <input type="number" step="1" class="form-control" id="avg_price_per_sqft" name="avg_price_per_sqft" value="{{ locality.avg_price_per_sqft if locality.avg_price_per_sqft else '' }}" min="0" placeholder="Enter price">
                            <div class="input-unit">₹/sq ft</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="population_density" class="form-label"><i class="fas fa-users"></i> Population Density</label>
                        <div class="input-with-unit">
                            <input type="number" class="form-control" id="population_density" name="population_density" value="{{ locality.population_density if locality.population_density else '' }}" min="0" placeholder="Enter density">
                            <div class="input-unit">per km²</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="development_status" class="form-label"><i class="fas fa-chart-bar"></i> Development Status</label>
                        <select class="form-select" id="development_status" name="development_status">
                            <option value="">Select Status</option>
                            <option value="well_developed" {% if locality.development_status == 'well_developed' %}selected{% endif %}>Well Developed</option>
                            <option value="developing" {% if locality.development_status == 'developing' %}selected{% endif %}>Developing</option>
                            <option value="upcoming" {% if locality.development_status == 'upcoming' %}selected{% endif %}>Upcoming</option>
                            <option value="established" {% if locality.development_status == 'established' %}selected{% endif %}>Established</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Description -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-file-alt"></i> Description</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="description" class="form-label"><i class="fas fa-comment-alt"></i> Locality Description</label>
                        <textarea class="form-control" id="description" name="description" rows="4" placeholder="Describe the locality, its features, amenities, and unique selling points">{{ locality.description }}</textarea>
                    </div>
                </div>
            </div>
            
            <!-- Features -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-star"></i> Locality Features</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_metro" name="has_metro" {% if locality.has_metro %}checked{% endif %}>
                        <label class="form-check-label" for="has_metro">
                            <i class="fas fa-subway"></i> Metro Connectivity
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_schools" name="has_schools" {% if locality.has_schools %}checked{% endif %}>
                        <label class="form-check-label" for="has_schools">
                            <i class="fas fa-school"></i> Schools Nearby
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_hospitals" name="has_hospitals" {% if locality.has_hospitals %}checked{% endif %}>
                        <label class="form-check-label" for="has_hospitals">
                            <i class="fas fa-hospital"></i> Hospitals Nearby
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_shopping" name="has_shopping" {% if locality.has_shopping %}checked{% endif %}>
                        <label class="form-check-label" for="has_shopping">
                            <i class="fas fa-shopping-cart"></i> Shopping Centers
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_parks" name="has_parks" {% if locality.has_parks %}checked{% endif %}>
                        <label class="form-check-label" for="has_parks">
                            <i class="fas fa-tree"></i> Parks & Recreation
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="has_restaurants" name="has_restaurants" {% if locality.has_restaurants %}checked{% endif %}>
                        <label class="form-check-label" for="has_restaurants">
                            <i class="fas fa-utensils"></i> Restaurants
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="is_gated" name="is_gated" {% if locality.is_gated %}checked{% endif %}>
                        <label class="form-check-label" for="is_gated">
                            <i class="fas fa-shield-alt"></i> Gated Community
                        </label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if locality.is_active %}checked{% endif %}>
                        <label class="form-check-label" for="is_active">
                            <i class="fas fa-check-circle"></i> Active
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Additional Information -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6 class="text-primary mb-3"><i class="fas fa-info-circle"></i> Additional Information</h6>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="created_at" class="form-label"><i class="fas fa-calendar"></i> Created At</label>
                        <input type="text" class="form-control" id="created_at" value="{{ locality.created_at.strftime('%d %b %Y %H:%M') if locality.created_at else '' }}" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="updated_at" class="form-label"><i class="fas fa-calendar-edit"></i> Last Updated</label>
                        <input type="text" class="form-control" id="updated_at" value="{{ locality.updated_at.strftime('%d %b %Y %H:%M') if locality.updated_at else '' }}" readonly>
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <hr>
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('admin.localities') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Localities
                        </a>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-luxury">
                                <i class="fas fa-save"></i> Update Locality
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Pincode validation
    $('#pincode').on('input', function() {
        const pincode = $(this).val();
        if (pincode && !(/^[0-9]{6}$/.test(pincode))) {
            $(this).addClass('is-invalid');
            if (!$(this).parent().find('.invalid-feedback').length) {
                $(this).parent().append('<div class="invalid-feedback">Pincode must be exactly 6 digits.</div>');
            }
        } else {
            $(this).removeClass('is-invalid');
            $(this).parent().find('.invalid-feedback').remove();
        }
    });
    
    // Coordinate validation
    $('#latitude').on('input', function() {
        const lat = parseFloat($(this).val());
        if (!isNaN(lat)) {
            if (lat < -90 || lat > 90) {
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        }
    });
    
    $('#longitude').on('input', function() {
        const lng = parseFloat($(this).val());
        if (!isNaN(lng)) {
            if (lng < -180 || lng > 180) {
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        }
    });
    
    // Form validation
    $('#localityForm').on('submit', function(e) {
        let isValid = true;
        
        // Check required fields
        const requiredFields = ['name', 'city_id'];
        requiredFields.forEach(field => {
            const element = $('#' + field);
            if (!element.val()) {
                element.addClass('is-invalid');
                isValid = false;
            } else {
                element.removeClass('is-invalid');
            }
        });
        
        // Validate pincode if provided
        const pincode = $('#pincode').val();
        if (pincode && !(/^[0-9]{6}$/.test(pincode))) {
            $('#pincode').addClass('is-invalid');
            isValid = false;
        }
        
        // Validate coordinates if provided
        const lat = parseFloat($('#latitude').val());
        const lng = parseFloat($('#longitude').val());
        
        if (!isNaN(lat) && (lat < -90 || lat > 90)) {
            $('#latitude').addClass('is-invalid');
            isValid = false;
        }
        
        if (!isNaN(lng) && (lng < -180 || lng > 180)) {
            $('#longitude').addClass('is-invalid');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fix the errors in the form.');
        }
    });
});
</script>
{% endblock %}