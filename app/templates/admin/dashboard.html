{% extends "admin/base.html" %}

{% block title %}Dashboard - Premium Real Estate Admin{% endblock %}
{% block page_title %}Executive Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=5.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <!-- Background Patterns -->
        <div class="grid-pattern"></div>
        
        <!-- Decorative Elements -->
        <div class="decorative-circle-1"></div>
        <div class="decorative-circle-2"></div>
        <div class="hexagon-pattern"></div>
        
        <div class="welcome-content">
            <h1 class="welcome-title">Welcome to Your Premium Real Estate Dashboard</h1>
            <p class="welcome-subtitle">Track your portfolio performance and manage properties with excellence</p>
            <div class="welcome-stats">
                <div class="welcome-stat">
                    <div class="welcome-stat-value">{{ stats.total_units }}</div>
                    <div class="welcome-stat-label">Property Units</div>
                </div>
                <div class="welcome-stat">
                    <div class="welcome-stat-value">{{ stats.total_projects }}</div>
                    <div class="welcome-stat-label">Active Properties</div>
                </div>
                <div class="welcome-stat">
                    <div class="welcome-stat-value">{{ "{:.1f}".format((stats.active_projects / stats.total_projects * 100) if stats.total_projects > 0 else 0) }}%</div>
                    <div class="welcome-stat-label">Occupancy Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Statistics Cards -->
    <div class="luxury-stats-grid">
        <!-- Active Projects -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-primary">
                    <i class="fas fa-building"></i>
                </div>
                <span class="stat-trend trend-up">
                    <i class="fas fa-arrow-up"></i> 8.3%
                </span>
            </div>
            <div class="stat-value">{{ stats.active_projects }}</div>
            <div class="stat-label">Active Projects</div>
            <div class="stat-footer">
                <span class="stat-footer-text">{{ stats.total_projects }} total projects</span>
                <a href="{{ url_for('admin.projects') }}" class="stat-footer-link">Manage →</a>
            </div>
        </div>

        <!-- Total Developers -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-success">
                    <i class="fas fa-users-cog"></i>
                </div>
                <span class="stat-trend trend-up">
                    <i class="fas fa-arrow-up"></i> 5.2%
                </span>
            </div>
            <div class="stat-value">{{ stats.total_developers }}</div>
            <div class="stat-label">Partner Developers</div>
            <div class="stat-footer">
                <span class="stat-footer-text">3 new this month</span>
                <a href="{{ url_for('admin.developers') }}" class="stat-footer-link">View All →</a>
            </div>
        </div>

        <!-- Registered Users -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-warning">
                    <i class="fas fa-user-friends"></i>
                </div>
                <span class="stat-trend trend-up">
                    <i class="fas fa-arrow-up"></i> 15.7%
                </span>
            </div>
            <div class="stat-value">{{ stats.total_users }}</div>
            <div class="stat-label">Registered Users</div>
            <div class="stat-footer">
                <span class="stat-footer-text">125 active today</span>
                <a href="{{ url_for('admin.users') }}" class="stat-footer-link">Manage →</a>
            </div>
        </div>

        <!-- Customer Reviews -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-info">
                    <i class="fas fa-star"></i>
                </div>
                <span class="stat-trend trend-up">
                    <i class="fas fa-arrow-up"></i> 4.8★
                </span>
            </div>
            <div class="stat-value">{{ stats.total_reviews }}</div>
            <div class="stat-label">Customer Reviews</div>
            <div class="stat-footer">
                <span class="stat-footer-text">4.8/5 average rating</span>
                <a href="{{ url_for('admin.reviews') }}" class="stat-footer-link">Read Reviews →</a>
            </div>
        </div>

        <!-- Property Units Available -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-luxury">
                    <i class="fas fa-home"></i>
                </div>
                <span class="stat-trend trend-up">
                    <i class="fas fa-arrow-up"></i> 12%
                </span>
            </div>
            <div class="stat-value">{{ stats.total_units or 0 }}</div>
            <div class="stat-label">Property Units</div>
            <div class="stat-footer">
                <span class="stat-footer-text">Available for sale</span>
                <a href="{{ url_for('admin.property_units') }}" class="stat-footer-link">View Units →</a>
            </div>
        </div>

        <!-- Pending Approvals -->
        <div class="luxury-stat-card">
            <div class="stat-header">
                <div class="stat-icon-wrapper icon-danger">
                    <i class="fas fa-clock"></i>
                </div>
                {% if stats.pending_approvals > 0 %}
                <span class="pulse-animation stat-trend" style="background: rgba(231, 76, 60, 0.1); color: #e74c3c;">
                    <i class="fas fa-exclamation"></i> Action Required
                </span>
                {% else %}
                <span class="stat-trend" style="background: rgba(46, 213, 115, 0.1); color: #2ed573;">
                    <i class="fas fa-check"></i> All Clear
                </span>
                {% endif %}
            </div>
            <div class="stat-value">{{ stats.pending_approvals }}</div>
            <div class="stat-label">Pending Approvals</div>
            <div class="stat-footer">
                <span class="stat-footer-text">Requires attention</span>
                <a href="{{ url_for('admin.project_approvals') }}" class="stat-footer-link">Review Now →</a>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="row">
        <!-- Premium Projects Table -->
        <div class="col-lg-8">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-building"></i>
                        Recent Premium Properties
                    </h3>
                    <div class="chart-actions">
                        <button class="chart-action-btn active">All</button>
                        <button class="chart-action-btn">Active</button>
                        <button class="chart-action-btn">Pending</button>
                    </div>
                </div>
                {% if stats.recent_projects %}
                <div class="luxury-table">
                    <table class="table mb-0">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>Developer</th>
                                <th>Status</th>
                                <th>Value</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in stats.recent_projects[:5] %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="me-3" style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white;">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold">{{ project.name }}</div>
                                            <small class="text-muted">{{ project.property_type.replace('_', ' ').title() }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ project.developer.name if project.developer else 'N/A' }}</td>
                                <td>
                                    {% if project.status == 'upcoming' %}
                                        <span class="status-badge status-pending">Upcoming</span>
                                    {% elif project.status == 'under_construction' %}
                                        <span class="status-badge status-pending">In Progress</span>
                                    {% elif project.status == 'ready_to_move' %}
                                        <span class="status-badge status-active">Ready</span>
                                    {% elif project.status == 'completed' %}
                                        <span class="status-badge status-completed">Completed</span>
                                    {% else %}
                                        <span class="status-badge">{{ project.status.replace('_', ' ').title() }}</span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold">₹{{ "{:,.0f}".format(project.min_price if project.min_price else 0) }}</td>
                                <td>
                                    <a href="{{ url_for('admin.view_project', project_id=project.project_id) }}" 
                                       class="btn btn-sm btn-outline-primary" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('admin.edit_project', project_id=project.project_id) }}" 
                                       class="btn btn-sm btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('admin.projects') }}" class="btn btn-primary">
                        View All Properties <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: 50%; background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-building fa-2x" style="color: #667eea;"></i>
                    </div>
                    <h5 class="text-muted">No properties yet</h5>
                    <p class="text-muted mb-4">Start by adding your first premium property</p>
                    <a href="{{ url_for('admin.new_project') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i> Add First Property
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Performance Charts -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-pie"></i>
                                Portfolio Distribution
                            </h3>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-line"></i>
                                Revenue Trend
                            </h3>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="col-lg-4">
            <!-- Recent Activities -->
            <div class="chart-card mb-4">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-bell"></i>
                        Recent Activities
                    </h3>
                </div>
                <div class="luxury-timeline">
                    {% set activities = [
                        {'title': 'New property added', 'desc': 'Sunrise Towers in Mumbai', 'time': '2 hours ago', 'type': 'property'},
                        {'title': 'User registration', 'desc': 'John Doe joined', 'time': '5 hours ago', 'type': 'user'},
                        {'title': 'Review submitted', 'desc': '5-star rating for Ocean View', 'time': '1 day ago', 'type': 'review'},
                        {'title': 'Payment received', 'desc': '₹15,00,000 for Unit A-101', 'time': '2 days ago', 'type': 'payment'},
                        {'title': 'Developer onboarded', 'desc': 'ABC Constructions', 'time': '3 days ago', 'type': 'developer'}
                    ] %}
                    {% for activity in activities %}
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <div class="timeline-header">
                                <span class="timeline-title">{{ activity.title }}</span>
                                {% if activity.type == 'property' %}
                                    <span class="timeline-badge">New</span>
                                {% endif %}
                            </div>
                            <p class="timeline-description">{{ activity.desc }}</p>
                            <div class="timeline-footer">
                                <span class="timeline-time">
                                    <i class="far fa-clock"></i> {{ activity.time }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-rocket"></i>
                        Quick Actions
                    </h3>
                </div>
                <div class="quick-actions-grid">
                    <a href="{{ url_for('admin.new_project') }}" class="quick-action-btn">
                        <div class="quick-action-icon icon-primary">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="quick-action-text">New Property</div>
                    </a>
                    <a href="{{ url_for('admin.new_developer') }}" class="quick-action-btn">
                        <div class="quick-action-icon icon-success">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="quick-action-text">Add Developer</div>
                    </a>
                    <a href="{{ url_for('admin.new_user') }}" class="quick-action-btn">
                        <div class="quick-action-icon icon-warning">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="quick-action-text">New User</div>
                    </a>
                    <a href="{{ url_for('admin.projects') }}" class="quick-action-btn">
                        <div class="quick-action-icon icon-info">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="quick-action-text">View Projects</div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button -->
<div class="fab-container">
    <button class="fab-button" onclick="window.location='{{ url_for('admin.new_project') }}'">
        <i class="fas fa-plus"></i>
    </button>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
    // Portfolio Distribution Chart
    const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
    const portfolioChart = new Chart(portfolioCtx, {
        type: 'doughnut',
        data: {
            labels: ['Residential', 'Commercial', 'Industrial', 'Mixed Use'],
            datasets: [{
                data: [45, 25, 15, 15],
                backgroundColor: [
                    'rgba(102, 126, 234, 0.8)',
                    'rgba(46, 213, 115, 0.8)',
                    'rgba(243, 156, 18, 0.8)',
                    'rgba(231, 76, 60, 0.8)'
                ],
                borderColor: [
                    'rgba(102, 126, 234, 1)',
                    'rgba(46, 213, 115, 1)',
                    'rgba(243, 156, 18, 1)',
                    'rgba(231, 76, 60, 1)'
                ],
                borderWidth: 3,
                hoverBorderWidth: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        font: {
                            size: 12,
                            weight: '600'
                        },
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: '600'
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + '%';
                        }
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeOutBounce'
            }
        }
    });

    // Revenue Trend Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const gradient = revenueCtx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(102, 126, 234, 0.3)');
    gradient.addColorStop(1, 'rgba(102, 126, 234, 0.01)');

    const revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Revenue (in Crores)',
                data: [12, 19, 15, 25, 22, 30],
                borderColor: 'rgba(102, 126, 234, 1)',
                backgroundColor: gradient,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: 'white',
                pointBorderColor: 'rgba(102, 126, 234, 1)',
                pointBorderWidth: 3,
                pointRadius: 5,
                pointHoverRadius: 8,
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)',
                        drawBorder: false
                    },
                    ticks: {
                        font: {
                            size: 11,
                            weight: '600'
                        },
                        color: '#666',
                        callback: function(value) {
                            return '₹' + value + 'Cr';
                        },
                        padding: 10
                    }
                },
                x: {
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        font: {
                            size: 11,
                            weight: '600'
                        },
                        color: '#666',
                        padding: 10
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: '600'
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        label: function(context) {
                            return 'Revenue: ₹' + context.parsed.y + ' Crores';
                        }
                    }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeInOutQuart'
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });

// Animate numbers on scroll
function animateValue(element, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const value = Math.floor(progress * (end - start) + start);
        element.textContent = value.toLocaleString();
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}

// Initialize animations when visible
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const statValue = entry.target;
            const endValue = parseInt(statValue.textContent.replace(/[^0-9]/g, ''));
            if (!isNaN(endValue)) {
                animateValue(statValue, 0, endValue, 1500);
                observer.unobserve(statValue);
            }
        }
    });
});

document.querySelectorAll('.stat-value').forEach(el => {
    observer.observe(el);
});

    // Filter buttons functionality
    document.querySelectorAll('.chart-action-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.chart-action-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
});
</script>
{% endblock %}