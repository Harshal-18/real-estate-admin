{% extends "admin/base.html" %}

{% block title %}{{ tower.tower_name }} - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">{{ tower.tower_name }}</h1>
        <div class="d-flex gap-2">
            <a href="{{ url_for('admin.edit_tower', tower_id=tower.tower_id) }}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{{ url_for('admin.towers') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Towers
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Tower Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Tower ID:</strong> {{ tower.tower_id }}</p>
                            <p><strong>Name:</strong> {{ tower.tower_name }}</p>
                            <p><strong>Number:</strong> 
                                <span class="badge bg-primary">{{ tower.tower_number or 'N/A' }}</span>
                            </p>
                            <p><strong>Project:</strong> 
                                {% if tower.project %}
                                    <a href="{{ url_for('admin.view_project', project_id=tower.project.project_id) }}">
                                        {{ tower.project.name }}
                                    </a>
                                {% else %}
                                    N/A
                                {% endif %}
                            </p>
                            <p><strong>Type:</strong> 
                                <span class="badge bg-info">{{ tower.tower_type or 'N/A' }}</span>
                            </p>
                            <p><strong>Construction Status:</strong> 
                                <span class="badge bg-{{ 'success' if tower.construction_status == 'completed' else 'warning' if tower.construction_status == 'under_construction' else 'secondary' }}">
                                    <i class="fas fa-{{ 'check-circle' if tower.construction_status == 'completed' else 'hard-hat' if tower.construction_status == 'under_construction' else 'clock' }}"></i>
                                    {{ tower.construction_status or 'N/A' }}
                                </span>
                            </p>
                            <p><strong>Possession Date:</strong> 
                                {% if tower.possession_date %}
                                    <span class="badge bg-info">
                                        <i class="fas fa-calendar"></i> {{ tower.possession_date.strftime('%Y-%m-%d') }}
                                    </span>
                                {% else %}
                                    N/A
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Total Floors:</strong> 
                                <span class="badge bg-secondary">{{ tower.total_floors or 0 }}</span>
                            </p>
                            <p><strong>Units per Floor:</strong> 
                                <span class="badge bg-secondary">{{ tower.units_per_floor or 0 }}</span>
                            </p>
                            <p><strong>Total Units:</strong> 
                                <span class="badge bg-primary">{{ tower.total_units or 0 }}</span>
                            </p>
                            <p><strong>Height:</strong> 
                                {% if tower.height_meters %}
                                    <span class="badge bg-info">{{ tower.height_meters }} meters</span>
                                {% else %}
                                    N/A
                                {% endif %}
                            </p>
                            <p><strong>Elevator Count:</strong> 
                                <span class="badge bg-secondary">{{ tower.elevator_count or 0 }}</span>
                            </p>
                            <p><strong>Facing Direction:</strong> 
                                <span class="badge bg-info">{{ tower.facing_direction or 'N/A' }}</span>
                            </p>
                            <p><strong>Status:</strong> 
                                <span class="badge bg-{{ 'success' if tower.is_active else 'danger' }}">
                                    <i class="fas fa-{{ 'check-circle' if tower.is_active else 'times-circle' }}"></i>
                                    {{ 'Active' if tower.is_active else 'Inactive' }}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">Facilities & Safety</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <i class="fas fa-bolt fa-2x text-{{ 'success' if tower.has_power_backup else 'secondary' }} mb-2"></i>
                                <p class="mb-0"><strong>Power Backup</strong></p>
                                <span class="badge bg-{{ 'success' if tower.has_power_backup else 'secondary' }}">
                                    {{ 'Available' if tower.has_power_backup else 'Not Available' }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <i class="fas fa-tint fa-2x text-{{ 'success' if tower.has_water_backup else 'secondary' }} mb-2"></i>
                                <p class="mb-0"><strong>Water Backup</strong></p>
                                <span class="badge bg-{{ 'success' if tower.has_water_backup else 'secondary' }}">
                                    {{ 'Available' if tower.has_water_backup else 'Not Available' }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <i class="fas fa-fire-extinguisher fa-2x text-{{ 'success' if tower.has_fire_safety else 'secondary' }} mb-2"></i>
                                <p class="mb-0"><strong>Fire Safety</strong></p>
                                <span class="badge bg-{{ 'success' if tower.has_fire_safety else 'secondary' }}">
                                    {{ 'Available' if tower.has_fire_safety else 'Not Available' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if tower.latitude and tower.longitude %}
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">Location</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-map-marker-alt"></i> Coordinates: {{ tower.latitude }}, {{ tower.longitude }}
                        <a href="https://www.google.com/maps?q={{ tower.latitude }},{{ tower.longitude }}" target="_blank" class="btn btn-sm btn-outline-primary float-end">
                            <i class="fas fa-external-link-alt"></i> View on Google Maps
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Total Floors:</span>
                        <span class="badge bg-primary">{{ tower.total_floors or 0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Total Units:</span>
                        <span class="badge bg-success">{{ tower.total_units or 0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Units per Floor:</span>
                        <span class="badge bg-info">{{ tower.units_per_floor or 0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Elevators:</span>
                        <span class="badge bg-secondary">{{ tower.elevator_count or 0 }}</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('admin.new_property_unit') }}?tower_id={{ tower.tower_id }}" class="btn btn-outline-primary">
                            <i class="fas fa-plus"></i> Add Property Unit
                        </a>
                        <a href="{{ url_for('admin.property_units') }}?tower_id={{ tower.tower_id }}" class="btn btn-outline-success">
                            <i class="fas fa-home"></i> View Units
                        </a>
                        {% if tower.project %}
                        <a href="{{ url_for('admin.view_project', project_id=tower.project.project_id) }}" class="btn btn-outline-info">
                            <i class="fas fa-building"></i> View Project
                        </a>
                        {% endif %}
                        <button class="btn btn-outline-danger" onclick="if(confirm('Are you sure you want to delete this tower?')) { document.getElementById('delete-form').submit(); }">
                            <i class="fas fa-trash"></i> Delete Tower
                        </button>
                        <form id="delete-form" action="{{ url_for('admin.delete_tower', tower_id=tower.tower_id) }}" method="POST" style="display: none;">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}